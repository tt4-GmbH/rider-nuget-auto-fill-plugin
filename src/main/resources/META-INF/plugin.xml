<idea-plugin>
<id>com.tt4.rider-nuget-autofill</id>
<name>NuGet Auto-Fill</name>
<vendor email="martin.schloegl@tt-four.com" url="https://github.com/ms-tt-four">Martin Schloegl</vendor>

<description><![CDATA[
        <h1>NuGet Auto-Fill</h1>
        <p>Automatically detects and fills NuGet feed credential dialogs in JetBrains Rider.</p>

        <h3>Features:</h3>
        <ul>
            <li>Automatic detection of NuGet credential dialogs</li>
            <li>Secure storage of feed credentials using system keychain</li>
            <li>Support for multiple NuGet feeds (NuGet.org, Azure DevOps, Artifactory, GitHub Packages, etc.)</li>
            <li>Configurable auto-submit behavior</li>
            <li>Easy credential management interface</li>
        </ul>

        <h3>How to Use:</h3>
        <ol>
            <li>Go to Tools → Manage NuGet Credentials</li>
            <li>Add your NuGet feed credentials</li>
            <li>The plugin will automatically fill credentials when Rider requests authentication</li>
        </ol>

        <h3>Supported NuGet Feeds:</h3>
        <ul>
            <li>NuGet.org</li>
            <li>Azure DevOps Artifacts</li>
            <li>JFrog Artifactory</li>
            <li>Sonatype Nexus</li>
            <li>GitHub Packages</li>
            <li>MyGet</li>
            <li>Any custom NuGet feed requiring authentication</li>
        </ul>
    ]]></description>

<change-notes><![CDATA[
        <h3>Version 1.0.7</h3>
        <ul>
            <li>Fixed: first credential dialog on startup was missed because the plugin initialised too late (after the user first focused the window) — the AWT listener is now registered during project open, before NuGet auto-restore can trigger a dialog</li>
        </ul>

        <h3>Version 1.0.6</h3>
        <ul>
            <li>Fixed: credential dialogs that appear during Rider startup (before the plugin is fully activated) are now detected and filled</li>
            <li>Fixed: dialogs shown a second time via the same window instance (reused by the platform) were not detected — now caught via an additional window activation listener with deduplication</li>
            <li>Fixed: feed URL could not be found in dialogs where the label is nested more than two levels deep in the component tree — URL search is now fully recursive</li>
        </ul>

        <h3>Version 1.0.5</h3>
        <ul>
            <li>Fixed: credentials for different feeds with the same username overwrote each other in the keychain — each feed now gets its own isolated keychain entry</li>
            <li>Existing credentials stored by earlier versions are automatically migrated to the new keychain format on first use — no manual re-entry required</li>
        </ul>

        <h3>Version 1.0.4</h3>
        <ul>
            <li>Fixed: all UI callbacks (dialogs, auto-fill) now run with the correct modality state — they were silently deferred until the plugin dialog was closed</li>
            <li>Fixed: credential storage is now atomic — if the keychain write fails, the feed is not left in a broken half-stored state</li>
            <li>Fixed: second (and subsequent) credentials could silently fail to persist on some keychain backends — writes are now retried with read-back verification</li>
        </ul>

        <h3>Version 1.0.3</h3>
        <ul>
            <li>Fixed: credentials occasionally not stored correctly due to PasswordSafe being called on the UI thread — all keychain operations are now performed on a background thread</li>
            <li>Fixed: Test button silently did nothing when credentials could not be retrieved — now shows a clear error message</li>
            <li>Fixed: storage failures are now detected immediately via read-back verification and reported to the user</li>
            <li>Fixed: auto-fill engine also called PasswordSafe on the UI thread when a credential dialog was detected — now correctly offloads keychain access to a background thread</li>
        </ul>

        <h3>Version 1.0.2</h3>
        <ul>
            <li>Improved: credential dialog detection now also matches "Authorization Required", "Credentials", "Log In", "Azure DevOps", and "Personal Access Token" dialog titles</li>
            <li>Improved: added content-based fallback detection — dialogs with a password field and a NuGet feed URL are now detected even if their title is unknown</li>
            <li>Improved: all window open events are now logged at DEBUG level, making it easy to diagnose missed dialogs via Help → Diagnostic Tools → Show Log in Finder</li>
        </ul>

        <h3>Version 1.0.1</h3>
        <ul>
            <li>Fixed: credentials being lost when Rider freezes or is force-killed (e.g. due to proxy issues)</li>
            <li>Credentials are now automatically restored from a backup if the main state file is empty or corrupted on startup</li>
            <li>Fixed: credential dialog detection was case-sensitive, causing some dialogs to be missed</li>
        </ul>

        <h3>Version 1.0.0</h3>
        <ul>
            <li>Initial release</li>
            <li>Automatic NuGet credential dialog detection and filling (case-insensitive)</li>
            <li>Secure credential storage using the system keychain (macOS Keychain, Windows Credential Manager)</li>
            <li>Crash-resistant storage — credentials are automatically restored from backup if Rider is force-killed or freezes</li>
            <li>Multi-feed support with per-feed enable/disable and auto-submit settings</li>
            <li>Quick setup templates for NuGet.org, Azure DevOps, and GitHub Packages</li>
            <li>Management UI accessible via Tools → Manage NuGet Credentials</li>
        </ul>
    ]]></change-notes>

    <idea-version since-build="241"/>

    <depends>com.intellij.modules.rider</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!--
            Initializes the AWT dialog listener during project open — before NuGet
            auto-restore can trigger a credential dialog. The ApplicationActivationListener
            below remains as a fallback for edge cases.
        -->
        <postStartupActivity implementation="com.tt4.rider.nuget.NuGetStartupActivity"/>
    </extensions>

    <applicationListeners>
        <listener class="com.tt4.rider.nuget.NuGetStartupListener"
                  topic="com.intellij.openapi.application.ApplicationActivationListener"/>
    </applicationListeners>

    <actions>
        <action id="com.tt4.rider.nuget.ManageCredentials"
                class="com.tt4.rider.nuget.actions.NuGetCredentialsAction"
                text="Manage NuGet Credentials">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
    </actions>
</idea-plugin>
